# Casbin Model Configuration for Neobrutalism CRM
# Model này hỗ trợ RBAC với multi-tenancy, hierarchical resources, và data scope

[request_definition]
# r = subject, domain, object, action, scope (optional)
r = sub, dom, obj, act, scope

[policy_definition]
# p = subject (role), domain (tenant), object (resource), action, effect, scope
p = sub, dom, obj, act, eft, scope

[role_definition]
# g = user, role, domain (user-role assignment)
g = _, _, _
# g2 = child_role, parent_role, domain (role hierarchy/inheritance)
g2 = _, _, _

[policy_effect]
# Allow if any policy allows and no policy explicitly denies
e = some(where (p.eft == allow)) && !some(where (p.eft == deny))

[matchers]
# Match:
# 1. User has role (g) or role inherits from parent role (g2)
# 2. Domain (tenant) matches
# 3. Resource path matches (regex)
# 4. Action matches (regex)
# 5. Scope is compatible (custom function)
m = (g(r.sub, p.sub, r.dom) || g2(p.sub, r.sub, r.dom)) && r.dom == p.dom && regexMatch(r.obj, p.obj) && regexMatch(r.act, p.act) && matchScope(r.scope, p.scope)
